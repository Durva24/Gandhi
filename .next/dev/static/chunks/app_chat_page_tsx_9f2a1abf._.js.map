{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Gandhi/app/chat/page.tsx"],"sourcesContent":["'use client';\nimport { useState, useEffect, useRef } from 'react';\nimport { Plus, Send, ArrowLeft } from 'lucide-react';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || '';\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '';\n\nif (!supabaseUrl || !supabaseKey) {\n  console.error('Missing Supabase environment variables');\n}\n\nconst supabase = createClient(supabaseUrl, supabaseKey);\n\ninterface Message {\n  id: string;\n  role: 'user' | 'assistant';\n  content: string;\n  created_at: string;\n}\n\ninterface Chat {\n  id: string;\n  name: string;\n  context: string;\n  created_at: string;\n}\n\nexport default function ChatInterface() {\n  const [chats, setChats] = useState<Chat[]>([]);\n  const [selectedChatId, setSelectedChatId] = useState<string | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [sending, setSending] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    fetchAllChats();\n  }, []);\n\n  useEffect(() => {\n    if (selectedChatId) {\n      fetchChatHistory(selectedChatId);\n    }\n  }, [selectedChatId]);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const fetchAllChats = async () => {\n    try {\n      const response = await fetch('/api/chat');\n      const data = await response.json();\n      \n      if (data.chats) {\n        setChats(data.chats);\n      }\n    } catch (error) {\n      console.error('Error fetching chats:', error);\n    }\n  };\n\n  const fetchChatHistory = async (chatId: string) => {\n    setLoading(true);\n    try {\n      const response = await fetch(`/api/chat?chatId=${chatId}`);\n      const data = await response.json();\n\n      if (data.chat && data.messages) {\n        setMessages(data.messages);\n      } else {\n        setMessages([]);\n      }\n    } catch (error) {\n      console.error('Error fetching chat history:', error);\n      setMessages([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const createNewChat = () => {\n    setSelectedChatId(null);\n    setMessages([]);\n    setInputMessage('');\n  };\n\n  const sendMessage = async () => {\n    if (!inputMessage.trim() || sending) {\n      console.log('Cannot send - input empty or already sending');\n      return;\n    }\n\n    const userMessage = inputMessage.trim();\n    console.log('Sending message:', userMessage);\n    setInputMessage('');\n    setSending(true);\n\n    // Optimistically add user message to UI\n    const tempUserMsg: Message = {\n      id: `temp-user-${Date.now()}`,\n      role: 'user',\n      content: userMessage,\n      created_at: new Date().toISOString()\n    };\n\n    setMessages(prev => [...prev, tempUserMsg]);\n\n    try {\n      console.log('Fetching with chatId:', selectedChatId);\n      const response = await fetch('/api/chat', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          chatId: selectedChatId,\n          message: userMessage\n        })\n      });\n\n      console.log('Response status:', response.status);\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        console.error('Error response:', errorData);\n        throw new Error(errorData.error || 'Failed to send message');\n      }\n\n      const data = await response.json();\n      console.log('Response data:', data);\n\n      // If this was a new chat, update the selected chat ID\n      if (!selectedChatId && data.chatId) {\n        console.log('New chat created:', data.chatId);\n        setSelectedChatId(data.chatId);\n        // Refresh the chats list to show the new chat\n        await fetchAllChats();\n      }\n\n      // Add AI response to messages\n      const aiMsg: Message = {\n        id: `ai-${Date.now()}`,\n        role: 'assistant',\n        content: data.message,\n        created_at: new Date().toISOString()\n      };\n\n      // Replace temp message and add AI response\n      setMessages(prev => {\n        const withoutTemp = prev.filter(m => m.id !== tempUserMsg.id);\n        return [\n          ...withoutTemp,\n          { ...tempUserMsg, id: `user-${Date.now()}` },\n          aiMsg\n        ];\n      });\n\n    } catch (error) {\n      console.error('Error sending message:', error);\n      \n      // Remove temp message on error\n      setMessages(prev => prev.filter(m => m.id !== tempUserMsg.id));\n      \n      // Show error to user\n      alert(`Failed to send message: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    }\n  };\n\n  const navigateToHome = () => {\n    window.location.href = '/home';\n  };\n\n  return (\n    <div className=\"h-screen bg-white font-sans flex flex-col overflow-hidden\">\n      {/* Header */}\n      <div className=\"px-5 py-4 flex items-center justify-between border-b-2 border-black\">\n        <div className=\"flex items-center gap-3\">\n          <button\n            onClick={navigateToHome}\n            className=\"bg-[#C4F000] border-2 border-black p-2 cursor-pointer hover:bg-[#B0E000] active:scale-95 transition-all\"\n            aria-label=\"Back to home\"\n          >\n            <ArrowLeft size={20} strokeWidth={2.5} color=\"#050505\" />\n          </button>\n          <div className=\"font-bold text-base tracking-widest text-black\">\n            FINANCIAL WISDOM CHAT\n          </div>\n        </div>\n        <div className=\"text-xs font-semibold text-black opacity-60\">\n          Powered by Neysa + Pipeshift\n        </div>\n      </div>\n\n      <div className=\"flex-1 flex overflow-hidden\">\n        {/* Sidebar */}\n        <div className=\"w-[280px] border-r-2 border-black flex flex-col overflow-hidden\">\n          <div className=\"p-4 border-b-2 border-black\">\n            <button\n              onClick={createNewChat}\n              className=\"w-full bg-[#C4F000] border-2 border-black px-3 py-3 text-xs font-bold text-black cursor-pointer tracking-wide flex items-center justify-center gap-2 hover:bg-[#B0E000] active:scale-95 transition-all\"\n            >\n              <Plus size={16} strokeWidth={3} />\n              NEW CHAT\n            </button>\n          </div>\n\n          <div className=\"flex-1 overflow-auto p-3\">\n            {chats.length === 0 ? (\n              <div className=\"p-5 text-center text-xs font-semibold text-black opacity-50\">\n                No chats yet\n              </div>\n            ) : (\n              <div className=\"flex flex-col gap-2\">\n                {chats.map(chat => (\n                  <div\n                    key={chat.id}\n                    onClick={() => setSelectedChatId(chat.id)}\n                    className={`p-3 cursor-pointer transition-all ${\n                      selectedChatId === chat.id\n                        ? 'bg-[#C4F000] border-2 border-black'\n                        : 'bg-gray-50 border border-gray-200 hover:bg-gray-100'\n                    }`}\n                  >\n                    <div className=\"text-xs font-bold text-black mb-1 overflow-hidden text-ellipsis whitespace-nowrap\">\n                      {chat.name}\n                    </div>\n                    <div className=\"text-[10px] font-semibold text-black opacity-60\">\n                      {new Date(chat.created_at).toLocaleDateString('en-IN')}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Main Chat Area */}\n        <div className=\"flex-1 flex flex-col overflow-hidden\">\n          <div className=\"flex-1 overflow-auto p-5 flex flex-col gap-4\">\n            {loading ? (\n              <div className=\"flex items-center justify-center h-full\">\n                <div className=\"text-xs font-bold text-black opacity-60\">\n                  Loading messages...\n                </div>\n              </div>\n            ) : messages.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center h-full gap-3\">\n                <div className=\"text-base font-extrabold text-black tracking-wide\">\n                  START A CONVERSATION\n                </div>\n                <div className=\"text-xs font-semibold text-black opacity-60 text-center max-w-md\">\n                  Ask for financial wisdom inspired by Gandhi's principles of simplicity and mindful spending\n                </div>\n              </div>\n            ) : (\n              <>\n                {messages.map(message => (\n                  <div\n                    key={message.id}\n                    className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                  >\n                    <div\n                      className={`max-w-[70%] border-2 border-black px-4 py-3.5 text-[13px] font-medium text-black leading-relaxed ${\n                        message.role === 'user' ? 'bg-[#C4F000]' : 'bg-white'\n                      }`}\n                    >\n                      {message.content}\n                    </div>\n                  </div>\n                ))}\n                {sending && (\n                  <div className=\"flex justify-start\">\n                    <div className=\"bg-gray-50 border-2 border-gray-200 px-4 py-3.5 text-[13px] font-medium text-black animate-pulse\">\n                      Thinking...\n                    </div>\n                  </div>\n                )}\n                <div ref={messagesEndRef} />\n              </>\n            )}\n          </div>\n\n          {/* Input Area */}\n          <div className=\"px-5 py-4 border-t-2 border-black flex gap-3\">\n            <input\n              type=\"text\"\n              value={inputMessage}\n              onChange={(e) => setInputMessage(e.target.value)}\n              onKeyPress={handleKeyPress}\n              placeholder=\"Ask for financial wisdom...\"\n              disabled={sending}\n              className=\"flex-1 bg-gray-50 border-2 border-black px-4 py-3 text-[13px] font-medium text-black outline-none disabled:opacity-50 disabled:cursor-not-allowed\"\n            />\n            <button\n              onClick={sendMessage}\n              disabled={!inputMessage.trim() || sending}\n              className={`border-2 border-black px-5 py-3 flex items-center justify-center transition-all ${\n                sending || !inputMessage.trim()\n                  ? 'bg-gray-100 cursor-not-allowed opacity-50'\n                  : 'bg-[#C4F000] cursor-pointer hover:bg-[#B0E000] active:scale-95'\n              }`}\n            >\n              <Send size={18} strokeWidth={2.5} color=\"#050505\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}