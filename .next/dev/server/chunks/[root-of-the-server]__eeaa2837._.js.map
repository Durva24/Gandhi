{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Gandhi/app/api/get/portfolio/route.tsx"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n\nexport async function GET(request: NextRequest) {\n  try {\n    const userId = request.nextUrl.searchParams.get('userId') || process.env.TEST_USER_ID;\n    const investmentId = request.nextUrl.searchParams.get('investmentId');\n    const type = request.nextUrl.searchParams.get('type');\n    const platform = request.nextUrl.searchParams.get('platform');\n    const assetName = request.nextUrl.searchParams.get('assetName');\n\n    if (!userId) {\n      return NextResponse.json({ error: 'userId required' }, { status: 400 });\n    }\n\n    let query = supabase.from('investments').select('*').eq('user_id', userId);\n\n    if (investmentId) {\n      query = query.eq('id', investmentId);\n    }\n    if (type) {\n      query = query.eq('type', type);\n    }\n    if (platform) {\n      query = query.ilike('platform', `%${platform}%`);\n    }\n    if (assetName) {\n      query = query.ilike('asset_name', `%${assetName}%`);\n    }\n\n    query = query.order('buy_date', { ascending: false });\n\n    const { data, error } = await query;\n\n    if (error) throw error;\n\n    // Add calculated fields to each investment\n    const dataWithMetrics = data?.map(investment => {\n      const totalInvestment = parseFloat(investment.buy_price) * parseFloat(investment.quantity);\n      const currentValue = parseFloat(investment.current_price) * parseFloat(investment.quantity);\n      const profitLoss = currentValue - totalInvestment;\n      const profitLossPercentage = totalInvestment > 0 \n        ? ((profitLoss / totalInvestment) * 100).toFixed(2) \n        : '0.00';\n\n      return {\n        ...investment,\n        total_investment: totalInvestment.toFixed(2),\n        current_value: currentValue.toFixed(2),\n        profit_loss: profitLoss.toFixed(2),\n        profit_loss_percentage: profitLossPercentage\n      };\n    });\n\n    // Calculate portfolio summary\n    const totalInvested = dataWithMetrics?.reduce(\n      (sum, inv) => sum + parseFloat(inv.total_investment), \n      0\n    ) || 0;\n    const totalCurrentValue = dataWithMetrics?.reduce(\n      (sum, inv) => sum + parseFloat(inv.current_value), \n      0\n    ) || 0;\n    const totalProfitLoss = totalCurrentValue - totalInvested;\n    const totalProfitLossPercentage = totalInvested > 0 \n      ? ((totalProfitLoss / totalInvested) * 100).toFixed(2) \n      : '0.00';\n\n    return NextResponse.json({\n      success: true,\n      data: dataWithMetrics,\n      count: data?.length || 0,\n      summary: {\n        totalInvested: totalInvested.toFixed(2),\n        totalCurrentValue: totalCurrentValue.toFixed(2),\n        totalProfitLoss: totalProfitLoss.toFixed(2),\n        totalProfitLossPercentage: totalProfitLossPercentage\n      }\n    });\n  } catch (error: any) {\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,WAAW,IAAA,yMAAY;AAKtB,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,SAAS,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC,aAAa,QAAQ,GAAG,CAAC,YAAY;QACrF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;QACtD,MAAM,OAAO,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;QAC9C,MAAM,WAAW,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;QAClD,MAAM,YAAY,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;QAEnD,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,IAAI,QAAQ,SAAS,IAAI,CAAC,eAAe,MAAM,CAAC,KAAK,EAAE,CAAC,WAAW;QAEnE,IAAI,cAAc;YAChB,QAAQ,MAAM,EAAE,CAAC,MAAM;QACzB;QACA,IAAI,MAAM;YACR,QAAQ,MAAM,EAAE,CAAC,QAAQ;QAC3B;QACA,IAAI,UAAU;YACZ,QAAQ,MAAM,KAAK,CAAC,YAAY,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;QACjD;QACA,IAAI,WAAW;YACb,QAAQ,MAAM,KAAK,CAAC,cAAc,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC;QACpD;QAEA,QAAQ,MAAM,KAAK,CAAC,YAAY;YAAE,WAAW;QAAM;QAEnD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM;QAE9B,IAAI,OAAO,MAAM;QAEjB,2CAA2C;QAC3C,MAAM,kBAAkB,MAAM,IAAI,CAAA;YAChC,MAAM,kBAAkB,WAAW,WAAW,SAAS,IAAI,WAAW,WAAW,QAAQ;YACzF,MAAM,eAAe,WAAW,WAAW,aAAa,IAAI,WAAW,WAAW,QAAQ;YAC1F,MAAM,aAAa,eAAe;YAClC,MAAM,uBAAuB,kBAAkB,IAC3C,CAAC,AAAC,aAAa,kBAAmB,GAAG,EAAE,OAAO,CAAC,KAC/C;YAEJ,OAAO;gBACL,GAAG,UAAU;gBACb,kBAAkB,gBAAgB,OAAO,CAAC;gBAC1C,eAAe,aAAa,OAAO,CAAC;gBACpC,aAAa,WAAW,OAAO,CAAC;gBAChC,wBAAwB;YAC1B;QACF;QAEA,8BAA8B;QAC9B,MAAM,gBAAgB,iBAAiB,OACrC,CAAC,KAAK,MAAQ,MAAM,WAAW,IAAI,gBAAgB,GACnD,MACG;QACL,MAAM,oBAAoB,iBAAiB,OACzC,CAAC,KAAK,MAAQ,MAAM,WAAW,IAAI,aAAa,GAChD,MACG;QACL,MAAM,kBAAkB,oBAAoB;QAC5C,MAAM,4BAA4B,gBAAgB,IAC9C,CAAC,AAAC,kBAAkB,gBAAiB,GAAG,EAAE,OAAO,CAAC,KAClD;QAEJ,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;YACN,OAAO,MAAM,UAAU;YACvB,SAAS;gBACP,eAAe,cAAc,OAAO,CAAC;gBACrC,mBAAmB,kBAAkB,OAAO,CAAC;gBAC7C,iBAAiB,gBAAgB,OAAO,CAAC;gBACzC,2BAA2B;YAC7B;QACF;IACF,EAAE,OAAO,OAAY;QACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF"}}]
}